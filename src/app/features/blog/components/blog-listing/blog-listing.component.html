<div class="blog-listing-container">
  <div class="container">
    <!-- Hero Section -->
    <section class="blog-hero">
      <h1 class="blog-title">All The Things</h1>
      <!-- <p class="blog-subtitle">
        Web dev guides, amateur detective work, and thoughts I needed to put somewhere.
      </p> -->
    </section>

    <!-- Blog Description -->
    <section class="blog-description">
      <p>
        Welcome to a collection of articles covering web development, technology insights, and in-depth explorations of topics that spark curiosity. Here you'll find practical guides for developers, detailed analysis of technical concepts, and occasional deep dives into subjects that deserve a closer look.
      </p>
      <!-- <p>
        Whether you're looking for tutorials on modern frameworks, insights into development best practices, or thoughtful examinations of interesting topics, this space offers content designed to inform, educate, and occasionally entertain. Browse by category, search for specific topics, or explore the latest additions to the collection.
      </p> -->
    </section>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-container">
        <mat-form-field class="search-field" appearance="fill">
          <mat-label>Search articles...</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="searchQuery"
            (input)="onSearchInput($any($event.target).value)"
            [matAutocomplete]="auto"
            placeholder="Try 'web development', 'productivity', 'tutorial'..."
          />
          <mat-icon matPrefix>search</mat-icon>
          @if (searchQuery()) {
            <button mat-icon-button matSuffix (click)="searchQuery.set(''); filteredArticles.set([])" aria-label="Clear search">
              <mat-icon>close</mat-icon>
            </button>
          }
        </mat-form-field>

        <mat-autocomplete
          #auto="matAutocomplete"
          (optionSelected)="onArticleSelected($event.option.value)"
          [displayWith]="displayArticle"
          class="blog-autocomplete"
        >
          @for (article of filteredArticles(); track article.id) {
            <mat-option [value]="article" class="blog-option">
              <div class="autocomplete-item">
                <div class="autocomplete-image">
                  <img [src]="article.heroImage.src" [alt]="article.title" />
                </div>
                <div class="autocomplete-content">
                  <div class="autocomplete-title">{{ article.title }}</div>
                  <div class="autocomplete-meta">
                    <span class="autocomplete-category">{{ article.category }}</span>
                    <span class="autocomplete-date">{{ formatDate(article.publishedDate) }}</span>
                  </div>
                </div>
              </div>
            </mat-option>
          }
          @if (searchQuery() && filteredArticles().length === 0) {
            <mat-option disabled>
              <div class="no-results-option">
                <mat-icon>search_off</mat-icon>
                <span>No articles found</span>
              </div>
            </mat-option>
          }
        </mat-autocomplete>
      </div>
    </div>

    <!-- Category Filters and View Toggle -->
    <div class="filters-and-view-container">
      <!-- Category Filters -->
      <div class="category-filters">
        <button
          mat-button
          [class.active]="!selectedCategory"
          (click)="clearFilters()"
          class="category-filter-btn"
        >
          All
        </button>
        @for (category of categories; track category) {
          <button
            mat-button
            [class.active]="selectedCategory === category"
            (click)="filterByCategory(category)"
            class="category-filter-btn"
          >
            {{ category }}
          </button>
        }
      </div>

      <!-- View Toggle -->
      <div class="view-toggle">
        <button
          mat-icon-button
          [class.active]="viewMode === 'tile'"
          (click)="setViewMode('tile')"
          aria-label="Tile view"
          matTooltip="Tile view"
        >
          <mat-icon>view_module</mat-icon>
        </button>
        <button
          mat-icon-button
          [class.active]="viewMode === 'list'"
          (click)="setViewMode('list')"
          aria-label="List view"
          matTooltip="List view"
        >
          <mat-icon>view_list</mat-icon>
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters" *ngIf="selectedCategory || selectedTag">
      <div class="active-filters">
        <span class="filter-label">Filtered by:</span>
        <mat-chip *ngIf="selectedCategory" class="filter-chip">
          {{ selectedCategory }}
          <button mat-icon-button (click)="clearFilters()" aria-label="Clear category filter">
            <mat-icon>close</mat-icon>
          </button>
        </mat-chip>
        <mat-chip *ngIf="selectedTag" class="filter-chip">
          #{{ selectedTag }}
          <button mat-icon-button (click)="clearFilters()" aria-label="Clear tag filter">
            <mat-icon>close</mat-icon>
          </button>
        </mat-chip>
      </div>
      <button mat-button (click)="clearFilters()" class="clear-filters-btn">
        Clear all filters
      </button>
    </div>

    <!-- Articles Tile View -->
    <div class="articles-grid" *ngIf="!loading && articles.length > 0 && viewMode === 'tile'">
      <article *ngFor="let article of articles" class="article-card">
        <a [routerLink]="['/blog', article.slug]" class="article-link">
          <div class="article-image-wrapper">
            <img
              [src]="article.heroImage.src"
              [alt]="article.heroImage.alt"
              class="article-image"
              loading="lazy"
            />
            <span class="article-category">{{ article.category }}</span>
          </div>

          <div class="article-content">
            <div class="article-meta">
              <span class="article-date">{{ formatDate(article.publishedDate) }}</span>
              <span class="article-reading-time">{{ article.readingTime | readingTime }}</span>
            </div>

            <h2 class="article-title">{{ article.title }}</h2>

            <p class="article-description">{{ article.description }}</p>

            <div class="article-footer">
              <div class="article-author">
                <img
                  *ngIf="article.author.avatar"
                  [src]="article.author.avatar"
                  [alt]="article.author.name"
                  class="author-avatar"
                />
                <span class="author-name">{{ article.author.name }}</span>
              </div>

              <div class="article-tags">
                <button
                  mat-chip-button
                  *ngFor="let tag of article.tags.slice(0, 2)"
                  (click)="filterByTag(tag); $event.preventDefault()"
                  class="tag-chip"
                >
                  #{{ tag }}
                </button>
              </div>
            </div>
          </div>
        </a>
      </article>
    </div>

    <!-- Articles List View -->
    <div class="articles-list" *ngIf="!loading && articles.length > 0 && viewMode === 'list'">
      <article *ngFor="let article of articles" class="article-list-item">
        <a [routerLink]="['/blog', article.slug]" class="article-list-link">
          <div class="article-list-image-wrapper">
            <img
              [src]="article.heroImage.src"
              [alt]="article.heroImage.alt"
              class="article-list-image"
              loading="lazy"
            />
          </div>

          <div class="article-list-content">
            <div class="article-list-header">
              <span class="article-list-category">{{ article.category }}</span>
              <div class="article-list-meta">
                <span class="article-date">{{ formatDate(article.publishedDate) }}</span>
                <span class="article-reading-time">{{ article.readingTime | readingTime }}</span>
              </div>
            </div>

            <h2 class="article-list-title">{{ article.title }}</h2>

            <p class="article-list-description">{{ article.description }}</p>
          </div>
        </a>
      </article>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && articles.length === 0">
      <mat-icon>article</mat-icon>
      <h2>No articles found</h2>
      <p>Try adjusting your filters or check back later for new content.</p>
      <button mat-raised-button color="primary" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <div class="loading-spinner">
      </div>
    </div>

    <!-- Pagination -->
    <app-pagination
      *ngIf="!loading && articles.length > 0"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
  </div>
</div>
