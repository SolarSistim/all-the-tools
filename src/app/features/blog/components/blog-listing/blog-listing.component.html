<div class="blog-listing-container">
  <div class="container">
    <!-- Hero Section -->
    <section class="blog-hero">
      <h1 class="blog-title">All The Things</h1>
      <p class="blog-subtitle">
        Articles, tutorials, and guides to help you get the most out of your web tools and boost your productivity.
      </p>
    </section>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-container">
        <mat-form-field class="search-field" appearance="fill">
          <mat-label>Search articles...</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="searchQuery"
            (input)="onSearchInput($any($event.target).value)"
            [matAutocomplete]="auto"
            placeholder="Try 'web development', 'productivity', 'tutorial'..."
          />
          <mat-icon matPrefix>search</mat-icon>
          @if (searchQuery()) {
            <button mat-icon-button matSuffix (click)="searchQuery.set(''); filteredArticles.set([])" aria-label="Clear search">
              <mat-icon>close</mat-icon>
            </button>
          }
        </mat-form-field>

        <mat-autocomplete
          #auto="matAutocomplete"
          (optionSelected)="onArticleSelected($event.option.value)"
          [displayWith]="displayArticle"
          class="blog-autocomplete"
        >
          @for (article of filteredArticles(); track article.id) {
            <mat-option [value]="article" class="blog-option">
              <div class="autocomplete-item">
                <div class="autocomplete-image">
                  <img [src]="article.heroImage.src" [alt]="article.title" />
                </div>
                <div class="autocomplete-content">
                  <div class="autocomplete-title">{{ article.title }}</div>
                  <div class="autocomplete-meta">
                    <span class="autocomplete-category">{{ article.category }}</span>
                    <span class="autocomplete-date">{{ formatDate(article.publishedDate) }}</span>
                  </div>
                </div>
              </div>
            </mat-option>
          }
          @if (searchQuery() && filteredArticles().length === 0) {
            <mat-option disabled>
              <div class="no-results-option">
                <mat-icon>search_off</mat-icon>
                <span>No articles found</span>
              </div>
            </mat-option>
          }
        </mat-autocomplete>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters" *ngIf="selectedCategory || selectedTag">
      <div class="active-filters">
        <span class="filter-label">Filtered by:</span>
        <mat-chip *ngIf="selectedCategory" class="filter-chip">
          {{ selectedCategory }}
          <button mat-icon-button (click)="clearFilters()" aria-label="Clear category filter">
            <mat-icon>close</mat-icon>
          </button>
        </mat-chip>
        <mat-chip *ngIf="selectedTag" class="filter-chip">
          #{{ selectedTag }}
          <button mat-icon-button (click)="clearFilters()" aria-label="Clear tag filter">
            <mat-icon>close</mat-icon>
          </button>
        </mat-chip>
      </div>
      <button mat-button (click)="clearFilters()" class="clear-filters-btn">
        Clear all filters
      </button>
    </div>

    <!-- Articles Grid -->
    <div class="articles-grid" *ngIf="!loading && articles.length > 0">
      <article *ngFor="let article of articles" class="article-card">
        <a [routerLink]="['/blog', article.slug]" class="article-link">
          <div class="article-image-wrapper">
            <img
              [src]="article.heroImage.src"
              [alt]="article.heroImage.alt"
              class="article-image"
              loading="lazy"
            />
            <span class="article-category">{{ article.category }}</span>
          </div>

          <div class="article-content">
            <div class="article-meta">
              <span class="article-date">{{ formatDate(article.publishedDate) }}</span>
              <span class="article-reading-time">{{ article.readingTime | readingTime }}</span>
            </div>

            <h2 class="article-title">{{ article.title }}</h2>

            <p class="article-description">{{ article.description }}</p>

            <div class="article-footer">
              <div class="article-author">
                <img
                  *ngIf="article.author.avatar"
                  [src]="article.author.avatar"
                  [alt]="article.author.name"
                  class="author-avatar"
                />
                <span class="author-name">{{ article.author.name }}</span>
              </div>

              <div class="article-tags">
                <button
                  mat-chip-button
                  *ngFor="let tag of article.tags.slice(0, 2)"
                  (click)="filterByTag(tag); $event.preventDefault()"
                  class="tag-chip"
                >
                  #{{ tag }}
                </button>
              </div>
            </div>
          </div>
        </a>
      </article>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && articles.length === 0">
      <mat-icon>article</mat-icon>
      <h2>No articles found</h2>
      <p>Try adjusting your filters or check back later for new content.</p>
      <button mat-raised-button color="primary" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <div class="loading-spinner">
      </div>
    </div>

    <!-- Pagination -->
    <app-pagination
      *ngIf="!loading && articles.length > 0"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
  </div>
</div>
