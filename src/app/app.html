<!-- Main App Layout -->
<mat-sidenav-container class="sidenav-container">
  <!-- Tools Browser Sidenav -->
  <mat-sidenav
    #toolsSidenav
    (closed)="closeToolsSidenav()"
    [opened]="sidenavOpened()"
    mode="side"
    position="start"
    class="tools-sidenav"
  >
    <div class="sidenav-header">
      <h2>Browse Tools</h2>
      <button
        mat-icon-button
        (click)="closeToolsSidenav()"
        aria-label="Close tools menu"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Navigation Buttons -->
    <div class="sidenav-nav">
      <a
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: true}"
        (click)="closeToolsSidenavIfMobile()"
        class="sidenav-nav-link"
      >
        <mat-icon>home</mat-icon>
        <span>Home</span>
      </a>

      @if (authReady$ | async) {
        @if (isAuthenticated$ | async) {
          <a
            routerLink="/account"
            routerLinkActive="active"
            (click)="closeToolsSidenavIfMobile()"
            class="sidenav-nav-link"
          >
            <mat-icon>account_circle</mat-icon>
            <span>My Account</span>
          </a>
        } @else {
          <button
            (click)="login(); closeToolsSidenavIfMobile()"
            class="sidenav-nav-link"
          >
            <mat-icon>login</mat-icon>
            <span>Login</span>
          </button>
        }
      }
    </div>

    <div class="sidenav-content">
      <!-- AllTheThings.dev Menu -->
      <mat-expansion-panel class="category-panel allthethings-panel">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon class="allthethings-icon">construction</mat-icon>
            <span class="category-name">AllTheThings.dev</span>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <!-- AllTheThings Links -->
        <div class="allthethings-links">
          <a
            routerLink="/tools"
            (click)="closeToolsSidenavIfMobile()"
            class="allthethings-link"
          >
            <mat-icon>apps</mat-icon>
            <span>All Tools</span>
          </a>

          <a
            routerLink="/3d-artist-spotlight"
            (click)="closeToolsSidenavIfMobile()"
            class="allthethings-link"
          >
            <mat-icon>3d_rotation</mat-icon>
            <span>3D Artist Spotlight</span>
          </a>

          <a
            routerLink="/why-sign-up"
            (click)="closeToolsSidenavIfMobile()"
            class="allthethings-link"
          >
            <mat-icon>how_to_reg</mat-icon>
            <span>Why Sign Up?</span>
          </a>

          <a
            routerLink="/resources"
            (click)="closeToolsSidenavIfMobile()"
            class="allthethings-link"
          >
            <mat-icon>link</mat-icon>
            <span>Resources</span>
          </a>

          <a
            routerLink="/about"
            (click)="closeToolsSidenavIfMobile()"
            class="allthethings-link"
          >
            <mat-icon>info</mat-icon>
            <span>About</span>
          </a>

          <a
            routerLink="/blog"
            (click)="closeToolsSidenavIfMobile()"
            class="allthethings-link"
          >
            <mat-icon>article</mat-icon>
            <span>Blog</span>
          </a>

          <a
            routerLink="/contact"
            (click)="closeToolsSidenavIfMobile()"
            class="allthethings-link"
          >
            <mat-icon>contact_mail</mat-icon>
            <span>Contact Us</span>
          </a>
        </div>
      </mat-expansion-panel>

      <!-- Category Expansion Panels -->
      @for (category of categories; track category.id) {
        @if (getToolCount(category.id) > 0) {
          <mat-expansion-panel class="category-panel">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="category-icon">{{ category.icon }}</mat-icon>
                <span class="category-name">{{ category.name }}</span>
                <span class="category-badge">{{ getToolCount(category.id) }}</span>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <!-- Tools List -->
            <div class="tools-list">
              @for (tool of getToolsByCategory(category.id); track tool.id) {
                <a
                  [routerLink]="getToolRouterLink(tool.route)"
                  (click)="closeToolsSidenavIfMobile()"
                  class="tool-item"
                >
                  <mat-icon class="tool-icon">{{ tool.icon }}</mat-icon>
                  <div class="tool-info">
                    <span class="tool-name">{{ tool.name }}</span>
                    <span class="tool-desc">{{ tool.description }}</span>
                  </div>
                </a>
              }
            </div>
          </mat-expansion-panel>
        }
      }
    </div>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content>
    <app-header></app-header>

    <main class="main-content">
      <router-outlet></router-outlet>
    </main>

    <app-footer></app-footer>

    <!-- Back to Top Button (Site-wide) -->
    <app-back-to-top></app-back-to-top>
  </mat-sidenav-content>
</mat-sidenav-container>
